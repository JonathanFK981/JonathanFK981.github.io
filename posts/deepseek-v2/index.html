<!DOCTYPE html>
<html lang="zh-Hans"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek-V2 | dO.ob&#39;s Blog</title>

    

<link rel="canonical" href="http://localhost:1313/posts/deepseek-v2/" />



<meta name="author" content="dO.ob" />
<meta name="description" content="DeepSeek-V2å…³é”®æŠ€æœ¯
" />


<meta name="keywords" content="LLM,AGI">



<meta name="generator" content="Hugo 0.146.2">


<meta property="og:url" content="http://localhost:1313/posts/deepseek-v2/">
  <meta property="og:site_name" content="dO.ob&#39;s Blog">
  <meta property="og:title" content="DeepSeek-V2">
  <meta property="og:description" content="DeepSeek-V2å…³é”®æŠ€æœ¯">
  <meta property="og:locale" content="zh_Hans">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-14T22:49:09+08:00">
    <meta property="article:modified_time" content="2025-04-14T22:49:09+08:00">
    <meta property="article:tag" content="LLM">
    <meta property="article:tag" content="AGI">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="DeepSeek-V2">
  <meta name="twitter:description" content="DeepSeek-V2å…³é”®æŠ€æœ¯">




<link rel="stylesheet" href="/css/output.css" />




<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']],
      displayMath: [['$$','$$']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 


    
<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)'], ['$', '$']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 


    


<style>
  pre {
    padding: 1em;
    overflow: auto;
  }
</style>









    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js" integrity="sha256-PtHu0lJIiSHfZeNj1nFd6wTX+Squ255SGZ/fc8seCtM=" crossorigin="anonymous"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 py-4">

  
  <div class="container flex justify-between max-w-[65ch] mx-auto px-4 md:px-0">
  
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title="ç¿»è½¬ä¸€ä¸‹ï¼">
        <div class="h-10 rounded-full">
          <img src="/img/logo.jpg" alt="Jonathan&#39;s Blog" />
        </div>
      </div>

      
      <div>
        
        <a href="http://localhost:1313/" class="text-lg font-semibold cursor-pointer">
          Jonathan&#39;s Blog
        </a>
        
        
      </div>
      
    </section>

    
    

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
        <ion-icon name="menu" class="text-2xl"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md">
        







<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="å…³äº">
    <ion-icon name="information-circle"></ion-icon>å…³äº</div>
</li>





















<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="å½’æ¡£">
    <ion-icon name="archive"></ion-icon>
    å½’æ¡£
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="æ‰€æœ‰åˆ†ç±»">
    <ion-icon name="grid"></ion-icon>
    æ‰€æœ‰åˆ†ç±»
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="æ‰€æœ‰æ ‡ç­¾">
    <ion-icon name="pricetags"></ion-icon>
    æ‰€æœ‰æ ‡ç­¾
  </a>
</li>






      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      

      
      




<div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="å…³äº">å…³äº</div>





      
      





      
      





      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="å½’æ¡£">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="æ‰€æœ‰åˆ†ç±»">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="æ‰€æœ‰æ ‡ç­¾">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


      

      

      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            
<div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4">
  <div class="hidden lg:block">
    
  </div>

  <div class="lg:col-span-2">
    <article class="mx-auto prose prose-quoteless dark:prose-invert" id="dream-single-post-main" itemscope itemtype="http://schema.org/Article">
      
  <meta itemprop="name" content="DeepSeek-V2">
  <meta itemprop="description" content="DeepSeek-V2å…³é”®æŠ€æœ¯">
  <meta itemprop="datePublished" content="2025-04-14T22:49:09+08:00">
  <meta itemprop="dateModified" content="2025-04-14T22:49:09+08:00">
  <meta itemprop="wordCount" content="872">
  <meta itemprop="keywords" content="LLM,AGI">

      <header>
        <h1 itemprop="headline">DeepSeek-V2</h1>
        <p class="text-sm">
          
            æ˜ŸæœŸä¸€, 4æœˆ 14, 2025
          

          | <span>5åˆ†é’Ÿé˜…è¯»</span>

          
          | <span>æ›´æ–°äº
            
              æ˜ŸæœŸä¸€, 4æœˆ 14, 2025
            </span>
          
        </p>

        
        <div class="flex justify-between">
          
            <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">dO.ob</span>
    
  
  </span>
</div>

          

          <div class="flex items-center gap-2">
  
  

  
  
  
  
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://x.com/intent/post?text=DeepSeek-V2&amp;url=http://localhost:1313/posts/deepseek-v2/" target="_blank" rel="noopener noreferrer"
      title="Share on X">
      <ion-icon class="group-hover:text-primary-content" name="logo-x"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://facebook.com/sharer/sharer.php?u=http://localhost:1313/posts/deepseek-v2/" target="_blank" rel="noopener noreferrer"
      title="Share on Facebook">
      <ion-icon class="group-hover:text-primary-content" name="logo-facebook"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://wa.me/?text=DeepSeek-V2%20http://localhost:1313/posts/deepseek-v2/" target="_blank" rel="noopener noreferrer"
      title="Share on WhatsApp">
      <ion-icon class="group-hover:text-primary-content" name="logo-whatsapp"></ion-icon>
    </a>
  

  
  
</div>

        </div>
      </header>

      <section id="dream-single-post-content" itemprop="articleBody">
        
          <img class="w-full z-30" src="/img/a.jpg" alt="DeepSeek-V2" />
        

        <p><em>DeepSeek-V2</em>å…³é”®æŠ€æœ¯</p>
<h2 id="architecture">Architecture</h2>
<p>æ€»ä½“è€Œè¨€ï¼Œ<em>DeepSeek-V2</em> ä»ç„¶é‡‡ç”¨çš„æ˜¯ <em>Transformer</em> æ¶æ„ï¼Œå…¶ä¸­æ¯ä¸ª <em>Transformer</em> æ¨¡å—éƒ½ç”±ä¸€ä¸ªæ³¨æ„åŠ›æ¨¡å—å’Œä¸€ä¸ª <em>FFN</em> ç»„æˆã€‚ç„¶è€Œï¼Œå¯¹äºæ³¨æ„åŠ›æ¨¡å—å’Œ <em>FFN</em>ï¼Œå›¢é˜Ÿå‡è®¾è®¡å¹¶é‡‡ç”¨äº†åˆ›æ–°çš„æ¶æ„ã€‚åœ¨æ³¨æ„åŠ›æ–¹é¢ï¼Œå›¢é˜Ÿè®¾è®¡äº† <em>Multi-head Latent Attentionï¼ˆMLAï¼‰</em>ï¼Œå®ƒåˆ©ç”¨ <em>Low-Rank Key-Value Joint Compression</em> æ¥æ¶ˆé™¤æ¨ç†æ—¶ <em>KV cache</em> çš„ç“¶é¢ˆï¼Œä»è€Œå®ç°é«˜æ•ˆçš„æ¨ç†ã€‚å¯¹äº <em>FFN</em>ï¼Œå›¢é˜Ÿé‡‡ç”¨äº† <em>DeepSeekMoE</em> æ¶æ„ï¼Œè¿™æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„ <em>MoE</em> æ¶æ„ï¼Œèƒ½å¤Ÿä»¥ç»æµçš„æˆæœ¬è®­ç»ƒå‡ºå¼ºå¤§çš„æ¨¡å‹ã€‚<em>DeepSeek-V2</em> çš„æ¶æ„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå›¢é˜Ÿå°†åœ¨æœ¬èŠ‚ä¸­ä»‹ç» <em>MLA</em> å’Œ <em>DeepSeekMoE</em> çš„è¯¦ç»†ä¿¡æ¯ã€‚<em>DeepSeek-V2</em> éµå¾ª <em>DeepSeek-67B</em> çš„è®¾ç½®ã€‚
<div class="embed-pdf-container" id="embed-pdf-container-29d60025">
    <div class="pdf-loadingWrapper" id="pdf-loadingWrapper-29d60025">
        <div class="pdf-loading" id="pdf-loading-29d60025"></div>
    </div>
    <div id="overlayText">
      <a href="./fig1.pdf" aria-label="Download" download>
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">
            <path d="M9 13c.3 0 .5-.1.7-.3L15.4 7 14 5.6l-4 4V1H8v8.6l-4-4L2.6 7l5.7 5.7c.2.2.4.3.7.3zm-7 2h14v2H2z" />
        </svg>
      </a>
    </div>
    <canvas class="pdf-canvas" id="pdf-canvas-29d60025"></canvas>
</div>

<div class="pdf-paginator" id="pdf-paginator-29d60025">
    <button id="pdf-prev-29d60025">Previous</button>
    <button id="pdf-next-29d60025">Next</button> &nbsp; &nbsp;
    <span>
      <span class="pdf-pagenum" id="pdf-pagenum-29d60025"></span> / <span class="pdf-pagecount" id="pdf-pagecount-29d60025"></span>
    </span>
    <a class="pdf-source" id="pdf-source-29d60025" href="./fig1.pdf">[pdf]</a>
</div>

<noscript>
View the PDF file <a class="pdf-source" id="pdf-source-noscript-29d60025" href="./fig1.pdf">here</a>.
</noscript>

<script type="text/javascript">
    (function(){
    var url = '.\/fig1.pdf';

    var hidePaginator = "" === "true";
    var hideLoader = "" === "true";
    var selectedPageNum = parseInt("") || 1;


    var showSource = "" === "true";
    var pageSource = document.getElementById("pdf-source-29d60025");

    
    function showSourcef() {
        if(showSource) {
            pageSource.style.display = 'inline';
        } else {
            pageSource.style.display = 'none';
        }
    }

    
    showSourcef();


    
    var pdfjsLib = window['pdfjs-dist/build/pdf'];

    
    if (pdfjsLib.GlobalWorkerOptions.workerSrc == '')
      pdfjsLib.GlobalWorkerOptions.workerSrc = "http:\/\/localhost:1313\/" + 'js/pdf-js/build/pdf.worker.js';

    
    var pdfDoc = null,
        pageNum = selectedPageNum,
        pageRendering = false,
        pageNumPending = null,
        scale = 3,
        canvas = document.getElementById('pdf-canvas-29d60025'),
        ctx = canvas.getContext('2d'),
        paginator = document.getElementById("pdf-paginator-29d60025"),
        loadingWrapper = document.getElementById('pdf-loadingWrapper-29d60025');


    
    showPaginator();
    showLoader();

    

    function renderPage(num) {
      pageRendering = true;
      
      pdfDoc.getPage(num).then(function(page) {
        var viewport = page.getViewport({scale: scale});
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        
        var renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };
        var renderTask = page.render(renderContext);

        
        renderTask.promise.then(function() {
          pageRendering = false;
          showContent();

          if (pageNumPending !== null) {
            
            renderPage(pageNumPending);
            pageNumPending = null;
          }
        });
      });

      
      document.getElementById('pdf-pagenum-29d60025').textContent = num;
    }

    

    function showContent() {
      loadingWrapper.style.display = 'none';
      canvas.style.display = 'block';
    }

    

    function showLoader() {
      if(hideLoader) return
      loadingWrapper.style.display = 'flex';
      canvas.style.display = 'none';
    }

    

    function showPaginator() {
      if(hidePaginator) return
      paginator.style.display = 'block';
    }

    

    function queueRenderPage(num) {
      if (pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }

    

    function onPrevPage() {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    }
    document.getElementById('pdf-prev-29d60025').addEventListener('click', onPrevPage);

    

    function onNextPage() {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    }
    document.getElementById('pdf-next-29d60025').addEventListener('click', onNextPage);

    

    pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
      pdfDoc = pdfDoc_;
      var numPages = pdfDoc.numPages;
      document.getElementById('pdf-pagecount-29d60025').textContent = numPages;

      
      if(pageNum > numPages) {
        pageNum = numPages
      }

      
      renderPage(pageNum);
    });
    })();
</script>
</p>
<h3 id="multi-head-latent-attention-boosting-inference-efficiency">Multi-Head Latent Attention: Boosting Inference Efficiency</h3>
<p>ä¼ ç»Ÿçš„ <em>Transformer</em> æ¨¡å‹é€šå¸¸é‡‡ç”¨ <em>MHA</em>ï¼Œä½†åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå…¶åºå¤§çš„ <em>KV cache</em> ä¼šæˆä¸ºé™åˆ¶æ¨ç†æ•ˆç‡çš„ç“¶é¢ˆã€‚ä¸ºäº†å‡å°‘ <em>KV cache</em> ï¼Œ<em>Multi Query Attention ï¼ˆMQAï¼‰</em> å’Œ <em>Group Query Attentionï¼ˆGQAï¼‰</em> åº”è¿è€Œç”Ÿã€‚å®ƒä»¬æ‰€éœ€çš„ <em>KV cache</em> è§„æ¨¡è¾ƒå°ï¼Œä½†æ€§èƒ½å´æ¯”ä¸ä¸Š <em>MHA</em> ï¼ˆä¸‹è¡¨ç»™å‡ºäº†å…³äº<em>MHA</em>ã€<em>GQA</em>å’Œ <em>MQA</em> çš„æ¶ˆèå®éªŒç»“æœï¼‰ã€‚</p>
<p><img src="./pic/3.jpg" alt=""></p>
<h4 id="comparison-between-mla-and-mha">Comparison Between MLA and MHA</h4>
<p>åœ¨ä¸‹è¡¨ä¸­å±•ç¤ºäº†åˆ†åˆ«é…å¤‡ <em>MLA</em> å’Œ <em>MLA</em> çš„ <em>MoE</em> åœ¨å››ä¸ªä¸¥è‹›åŸºå‡†æµ‹è¯•ä¸Šçš„è¯„ä¼°ç»“æœã€‚ä¸ºå¾—å‡ºå¯é ç»“è®ºï¼Œå›¢é˜Ÿåœ¨ä¸¤ç§è§„æ¨¡ä¸‹å¯¹æ¨¡å‹è¿›è¡Œäº†è®­ç»ƒå’Œè¯„ä¼°ã€‚ä¸¤ä¸ªå°å‹ <em>MoE</em> æ€»å‚æ•°é‡çº¦ä¸º160äº¿ï¼Œå›¢é˜Ÿä½¿ç”¨1.33ä¸‡äº¿ä¸ªè¯å…ƒå¯¹å®ƒä»¬è¿›è¡Œè®­ç»ƒã€‚ä¸¤ä¸ªå¤§å‹ <em>MoE</em> æ€»å‚æ•°é‡çº¦ä¸º2500äº¿ï¼Œå›¢é˜Ÿä½¿ç”¨4200äº¿ä¸ªè¯å…ƒå¯¹å®ƒä»¬è¿›è¡Œè®­ç»ƒã€‚æ­¤å¤–ï¼Œé™¤äº†æ³¨æ„åŠ›æœºåˆ¶ä¸åŒä¹‹å¤–ï¼Œä¸¤ä¸ªå°å‹ <em>MoE</em> å’Œä¸¤ä¸ªå¤§å‹ <em>MoE</em> åˆ†åˆ«å…·æœ‰ç›¸åŒçš„æ¶æ„ã€‚ä»è¡¨ä¸­å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ<em>MLA</em> çš„æ€§èƒ½ä¼˜äº <em>MHA</em>ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä¸ <em>MHA</em> ç›¸æ¯”ï¼Œ<em>MLA</em> æ‰€éœ€çš„ <em>KV cache</em> æ˜¾è‘—æ›´å°‘ï¼ˆå°å‹ <em>MoE</em> å°‘14%ï¼Œå¤§å‹ <em>MoE</em> å°‘4%ï¼‰ã€‚</p>
<p><img src="./pic/4.jpg" alt=""></p>
<p>å¯¹äº<em>DeepSeek-V2</em>, <em>MLA</em> é…å¤‡äº† <em>Low-Rank Key-Value Joint Compression</em> ï¼Œå…¶æ€§èƒ½ä¼˜äº <em>MHA</em>ï¼Œè€Œä¸”æ‰€éœ€çš„ <em>KV cache</em> å¤§å¹…å‡å°‘ã€‚</p>
<h4 id="standard-multi-head-attention">Standard Multi-Head Attention</h4>
<p>é¦–å…ˆä»‹ç»æ ‡å‡†çš„ <em>MHA</em> ä½œä¸ºèƒŒæ™¯ã€‚è®¾ $\displaystyle d$ ä¸ºåµŒå…¥ç»´åº¦ï¼Œ$\displaystyle ğ‘›_{â„}$ ä¸º <em>head</em> çš„æ•°é‡ï¼Œ$\displaystyle ğ‘‘_{â„}$ ä¸ºæ¯ä¸ª <em>head</em> çš„ç»´åº¦ï¼Œ$\displaystyle h_{t} \in {\mathbb R}^ğ‘‘ $ ä¸ºæ³¨æ„åŠ›å±‚ä¸­ç¬¬ $\displaystyle t$ ä¸ª <em>token</em> çš„è¾“å…¥ã€‚æ ‡å‡† çš„ <em>MHA</em> é¦–å…ˆé€šè¿‡ä¸‰ä¸ªçŸ©é˜µ $\displaystyle ğ‘Š^ğ‘„,ğ‘Š^ğ¾,ğ‘Š^ğ‘‰ \in {\mathbb R}^{ğ‘‘_{h}n_{â„}Ã—ğ‘‘}$ åˆ†åˆ«ç”Ÿæˆ $\displaystyle q_{t}, k_{t}, v_{t} \in {\mathbb R}^{{d_{h}}{n_{h}}}$ï¼š
\begin{equation}
\displaystyle q_{t}=ğ‘Š^ğ‘„h_{t}
\end{equation}</p>
<p>\begin{equation}
\displaystyle k_{t}=ğ‘Š^Kh_{t}
\end{equation}</p>
<p>\begin{equation}
\displaystyle v_{t}=ğ‘Š^Vh_{t}
\end{equation}</p>
<p>ç„¶åï¼Œ$\displaystyle q_{t}, k_{t}, v_{t}$ ä¼šè¢«åˆ†å‰²æˆ $\displaystyle ğ‘›_{â„}$ ä¸ª <em>head</em> ä»¥è¿›è¡Œ<em>MHA</em>è®¡ç®—ï¼š
</p>
\[
\displaystyle [q_{t,1};q_{t,2};\dots ;q_{t,n_{h}}] = q_t
\]\[
\displaystyle [k_{t,1};k_{t,2};\dots ;k_{t,n_{h}}] = k_t
\]\[
\displaystyle [v_{t,1};v_{t,2};\dots ;v_{t,n_{h}}] = v_t
\]\[
\displaystyle {o_{t,i}} = \sum\limits_{j = 1}^t {softmax_j\left( {\frac{{q_{t,i}^T{k_{j,i}}}}{{\sqrt {{d_h}} }}} \right){v_{j,i}}} 
\]\[\displaystyle {u_t} = {W^O}\left[ {o_{t,1};o_{t,2};\dots ;o_{t,n_{h}}} \right]\]<p>å…¶ä¸­ $\displaystyle q_{t,i}, k_{t,i}, v_{t,i} \in {\mathbb R}^{{d_{h}}}$åˆ†åˆ«è¡¨ç¤ºç¬¬ $ğ‘–$ ä¸ª <em>head</em> çš„ <em>query</em>ã€<em>key</em> å’Œ <em>value</em>ï¼›è€Œ $\displaystyle W^{O} \in {\mathbb R}^{ğ‘‘ \times d_{â„}n_{â„}}$ è¡¨ç¤ºè¾“å‡ºæŠ•å½±çŸ©é˜µã€‚åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„ <em>key</em> å’Œ <em>value</em> éƒ½éœ€è¦è¢«ç¼“å­˜ä»¥åŠ é€Ÿæ¨ç†è¿‡ç¨‹ï¼Œå› æ­¤ <em>MHA</em> éœ€è¦ä¸ºæ¯ä¸ª <em>token</em> ç¼“å­˜ $\displaystyle 2n_{â„}d_{â„}l$ ä¸ªå…ƒç´ ã€‚åœ¨æ¨¡å‹éƒ¨ç½²ä¸­ï¼Œè¿™ç§åºå¤§çš„ <em>KV cache</em> æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç“¶é¢ˆï¼Œé™åˆ¶äº†æœ€å¤§ <em>batch</em> å¤§å°å’Œåºåˆ—é•¿åº¦ã€‚</p>
<h4 id="low-rank-key-value-joint-compression">Low-Rank Key-Value Joint Compression</h4>
<p><em>MLA</em> çš„æ ¸å¿ƒæ˜¯é€šè¿‡ <em>Low-Rank</em> è”åˆå‹ç¼© <em>key</em> å’Œ <em>value</em> æ¥å‡å°‘ <em>KV cache</em> , è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
\[
  c_t^{KV} = {W^{DKV}}{h_t}
\]\[ k_t^C = {W^{UK}}c_t^{KV} \]\[V_t^C = {W^{UK}}c_t^{KV}\]<p>å…¶ä¸­ \( c_{t}^{KV} \in \mathbb{R}^{d_c} \) æ˜¯ <em>key</em> å’Œ <em>value</em> çš„ <em>compressed latent vector</em> ï¼›\( d_c (\ll d_h n_h) \) è¡¨ç¤º <em>KV</em> å‹ç¼©ç»´åº¦ï¼›\( W^{DKV} \in \mathbb{R}^{d_c \times d} \) æ˜¯ä¸‹æŠ•å½±çŸ©é˜µï¼›\( W^{UK}, W^{UV} \in \mathbb{R}^{d_h n_h \times d_c} \) åˆ†åˆ«æ˜¯ <em>key</em> å’Œ <em>value</em>  çš„ä¸ŠæŠ•å½±çŸ©é˜µã€‚åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼ŒMLAä»…éœ€ç¼“å­˜ \( c_t^{KV} \)ï¼Œå› æ­¤å…¶ <em>KV cache</em> ä»…æœ‰ \( d_c l \) ä¸ªå…ƒç´ (\( l \) è¡¨ç¤ºå±‚æ•°)ã€‚æ­¤å¤–ï¼Œåœ¨æ¨ç†æ—¶ï¼Œç”±äº \( W^{UK} \) å¯ä»¥è¢«å¸æ”¶åˆ° \( W^Q \) ä¸­ï¼Œä¸” \( W^{UV} \) å¯ä»¥è¢«å¸æ”¶åˆ° \( W^O \) ä¸­ï¼Œå›¢é˜Ÿç”šè‡³ä¸éœ€è¦è®¡ç®—æ³¨æ„åŠ›ä¸­çš„ <em>key</em> å’Œ <em>value</em>ã€‚ä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†<em>MLA</em> ä¸­çš„ <em>KV joint compression</em> æ˜¯å¦‚ä½•å‡å°‘ <em>KV cache</em> çš„ã€‚
<div class="embed-pdf-container" id="embed-pdf-container-1cfcaf78">
    <div class="pdf-loadingWrapper" id="pdf-loadingWrapper-1cfcaf78">
        <div class="pdf-loading" id="pdf-loading-1cfcaf78"></div>
    </div>
    <div id="overlayText">
      <a href="./fig2.pdf" aria-label="Download" download>
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">
            <path d="M9 13c.3 0 .5-.1.7-.3L15.4 7 14 5.6l-4 4V1H8v8.6l-4-4L2.6 7l5.7 5.7c.2.2.4.3.7.3zm-7 2h14v2H2z" />
        </svg>
      </a>
    </div>
    <canvas class="pdf-canvas" id="pdf-canvas-1cfcaf78"></canvas>
</div>

<div class="pdf-paginator" id="pdf-paginator-1cfcaf78">
    <button id="pdf-prev-1cfcaf78">Previous</button>
    <button id="pdf-next-1cfcaf78">Next</button> &nbsp; &nbsp;
    <span>
      <span class="pdf-pagenum" id="pdf-pagenum-1cfcaf78"></span> / <span class="pdf-pagecount" id="pdf-pagecount-1cfcaf78"></span>
    </span>
    <a class="pdf-source" id="pdf-source-1cfcaf78" href="./fig2.pdf">[pdf]</a>
</div>

<noscript>
View the PDF file <a class="pdf-source" id="pdf-source-noscript-1cfcaf78" href="./fig2.pdf">here</a>.
</noscript>

<script type="text/javascript">
    (function(){
    var url = '.\/fig2.pdf';

    var hidePaginator = "" === "true";
    var hideLoader = "" === "true";
    var selectedPageNum = parseInt("") || 1;


    var showSource = "" === "true";
    var pageSource = document.getElementById("pdf-source-1cfcaf78");

    
    function showSourcef() {
        if(showSource) {
            pageSource.style.display = 'inline';
        } else {
            pageSource.style.display = 'none';
        }
    }

    
    showSourcef();


    
    var pdfjsLib = window['pdfjs-dist/build/pdf'];

    
    if (pdfjsLib.GlobalWorkerOptions.workerSrc == '')
      pdfjsLib.GlobalWorkerOptions.workerSrc = "http:\/\/localhost:1313\/" + 'js/pdf-js/build/pdf.worker.js';

    
    var pdfDoc = null,
        pageNum = selectedPageNum,
        pageRendering = false,
        pageNumPending = null,
        scale = 3,
        canvas = document.getElementById('pdf-canvas-1cfcaf78'),
        ctx = canvas.getContext('2d'),
        paginator = document.getElementById("pdf-paginator-1cfcaf78"),
        loadingWrapper = document.getElementById('pdf-loadingWrapper-1cfcaf78');


    
    showPaginator();
    showLoader();

    

    function renderPage(num) {
      pageRendering = true;
      
      pdfDoc.getPage(num).then(function(page) {
        var viewport = page.getViewport({scale: scale});
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        
        var renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };
        var renderTask = page.render(renderContext);

        
        renderTask.promise.then(function() {
          pageRendering = false;
          showContent();

          if (pageNumPending !== null) {
            
            renderPage(pageNumPending);
            pageNumPending = null;
          }
        });
      });

      
      document.getElementById('pdf-pagenum-1cfcaf78').textContent = num;
    }

    

    function showContent() {
      loadingWrapper.style.display = 'none';
      canvas.style.display = 'block';
    }

    

    function showLoader() {
      if(hideLoader) return
      loadingWrapper.style.display = 'flex';
      canvas.style.display = 'none';
    }

    

    function showPaginator() {
      if(hidePaginator) return
      paginator.style.display = 'block';
    }

    

    function queueRenderPage(num) {
      if (pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }

    

    function onPrevPage() {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    }
    document.getElementById('pdf-prev-1cfcaf78').addEventListener('click', onPrevPage);

    

    function onNextPage() {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    }
    document.getElementById('pdf-next-1cfcaf78').addEventListener('click', onNextPage);

    

    pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
      pdfDoc = pdfDoc_;
      var numPages = pdfDoc.numPages;
      document.getElementById('pdf-pagecount-1cfcaf78').textContent = numPages;

      
      if(pageNum > numPages) {
        pageNum = numPages
      }

      
      renderPage(pageNum);
    });
    })();
</script>

æ­¤å¤–ï¼Œä¸ºäº†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‡å°‘æ¿€æ´»å†…å­˜çš„ä½¿ç”¨ï¼Œå›¢é˜Ÿè¿˜å¯¹ <em>query</em> è¿›è¡Œäº† <em>Low-Rank compression</em>ï¼Œå³ä½¿è¿™å¹¶ä¸ä¼šå‡å°‘ <em>KV</em> ç¼“å­˜ï¼š</p>
\[c_t^{Q} = {W^{DQ}}{h_t}\]\[q_t^{C} = {W^{UQ}}{c_t^{Q}}\]<p>å…¶ä¸­ $c_t^{Q} \in \mathbb{R}^{d_c^{\prime}}$ æ˜¯ <em>query</em> çš„ <em>compressed latent vector</em>ï¼›$d_c^{\prime}( \ll d_hn_h)$ è¡¨ç¤º <em>query</em> çš„å‹ç¼©ç»´åº¦ï¼›${W^{DQ}} \in {\mathbb R}^{d_c^{\prime} \times d}$ å’Œ ${W^{UQ}} \in {\mathbb R}^{d_hn_h \times d_c^{\prime}}$ åˆ†åˆ«æ˜¯ <em>query</em> çš„ä¸‹æŠ•å½±çŸ©é˜µå’Œä¸ŠæŠ•å½±çŸ©é˜µã€‚</p>
<h4 id="decoupled-rotary-position-embedding">Decoupled Rotary Position Embedding</h4>
<p>éµå¾ªDeepSeek 67Bçš„åšæ³•ï¼Œå›¢é˜ŸåŸè®¡åˆ’åœ¨ <em>DeepSeek-V2</em> ä¸­ä½¿ç”¨ <em>Rotary Position Embedding(RoPE)</em>ã€‚ç„¶è€Œï¼Œ<em>RoPE</em> ä¸ <em>Low-Rank KV compression</em> ä¸å…¼å®¹ã€‚å…·ä½“æ¥è¯´ï¼Œ<em>RoPE</em> å¯¹ <em>key</em> å’Œ <em>query</em> éƒ½æ˜¯ä½ç½®æ•æ„Ÿçš„ã€‚å¦‚æœå›¢é˜Ÿå¯¹ <em>key</em>  \( k_t^C \) åº”ç”¨ <em>RoPE</em> ï¼Œé‚£ä¹ˆæ–¹ç¨‹ <em>10</em> ä¸­çš„ \( W^{UK} \) å°†ä¼šä¸ä¸€ä¸ªä½ç½®æ•æ„Ÿçš„ <em>RoPE</em> çŸ©é˜µè€¦åˆã€‚è¿™æ ·ä¸€æ¥ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œ\( W^{UK} \) ä¸èƒ½å†è¢«å¸æ”¶åˆ°\( W^Q \)ä¸­ï¼Œå› ä¸ºä¸å½“å‰ç”Ÿæˆçš„ <em>token</em> ç›¸å…³çš„ <em>RoPE</em> çŸ©é˜µä¼šä½äº \( W^Q \) å’Œ \( W^{UK} \) ä¹‹é—´ï¼Œè€ŒçŸ©é˜µä¹˜æ³•ä¸æ»¡è¶³äº¤æ¢å¾‹ã€‚å› æ­¤ï¼Œå›¢é˜Ÿå¿…é¡»åœ¨æ¨ç†æ—¶é‡æ–°è®¡ç®—æ‰€æœ‰å‰ç¼€ <em>token</em> çš„ <em>key</em> ï¼Œè¿™å°†æ˜¾è‘—é˜»ç¢æ¨ç†æ•ˆç‡ã€‚</p>
<p>ä½œä¸ºè§£å†³æ–¹æ¡ˆï¼Œå›¢é˜Ÿæå‡ºäº† <em>Decoupled RoPE</em> ç­–ç•¥ï¼Œè¯¥ç­–ç•¥ä½¿ç”¨é¢å¤–çš„ <em>multi-head queries</em>  $q_{t,i}^R \in {{\mathbb R}^{d_h^R}}$â€‹ å’Œä¸€ä¸ªå…±äº«çš„ <em>key</em>  $k_t^R \in {{\mathbb R}^{d_h^R}}$â€‹ æ¥æ‰¿è½½<em>RoPE</em>ï¼Œå…¶ä¸­ $d_h^R$â€‹ è¡¨ç¤º<em>Decoupled query</em> å’Œ <em>key</em> çš„ <em>per-head</em> ç»´åº¦ã€‚é‡‡ç”¨<em>Decoupled RoPE</em> ç­–ç•¥åï¼Œ<em>MLA</em> æ‰§è¡Œä»¥ä¸‹è®¡ç®—ï¼š</p>
\[\left[ {q_{t,1}^R;q_{t,2}^R; \ldots ;q_{t,{n_h}}^R} \right] = q_t^R = RoPE\left( {{W^{QR}}c_t^Q} \right)\]\[k_t^R = RoPE\left( {{W^{KR}}{h_t}} \right)\]\[{o_{t,i}} = \sum\limits_{j = 1}^t {softmax_{j}} \left( {\frac{{q_{t,i}^T{k_{j,i}}}}{{\sqrt {{d_h} + d_h^R} }}} \right)v_{j,i}^C\]\[{u_t} = {W^O}\left[ {{o_{t,1}};{o_{t,2}}; \ldots ;{o_{t,{n_h}}}} \right]\]<p>å…¶ä¸­ ${W^{QR}} \in {{\mathbb R}^{d_h^R{n_h} \times d_c^{\prime}}}$ å’Œ ${W^{KR}} \in{\mathbb R}^{d_h^R \times d}$ åˆ†åˆ«æ˜¯ç”¨äºç”Ÿæˆè§£è€¦ <em>query</em> å’Œ <em>key</em> çš„çŸ©é˜µï¼›<em>RoPE(Â·)</em> è¡¨ç¤ºåº”ç”¨ <em>RoPE</em> çŸ©é˜µçš„æ“ä½œã€‚åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œè§£è€¦çš„ <em>key</em> ä¹Ÿéœ€è¦è¢«ç¼“å­˜ã€‚å› æ­¤ï¼Œ<em>DeepSeek-V2</em>æ€»å…±éœ€è¦ä¸€ä¸ªåŒ…å« $(dc+d^R_h)l$ ä¸ªå…ƒç´ çš„ <em>KV cache</em>ã€‚</p>
<p>ä¸ºäº†å®Œæ•´å±•ç¤ºMLAçš„è®¡ç®—è¿‡ç¨‹ï¼Œåœ¨é™„å½•Cä¸­æ•´ç†å¹¶æä¾›äº†å…¶å…¨éƒ¨å…¬å¼ã€‚è¿™æ ·åšå¯ä»¥è®©è¯»è€…æ›´æ¸…æ™°åœ°ç†è§£<em>MLA</em>çš„å…·ä½“è¿ä½œæœºåˆ¶åŠå…¶æ•°å­¦åŸç†ï¼Œä»è€Œä¾¿äºè¿›ä¸€æ­¥çš„ç ”ç©¶å’Œåº”ç”¨ã€‚</p>
<h4 id="comparison-of-key-value-cache">Comparison of Key-Value Cache</h4>
<p>ä¸‹è¡¨ä¸­å±•ç¤ºäº†ä¸åŒæ³¨æ„åŠ›æœºåˆ¶ä¹‹é—´æ¯ä¸ª <em>token</em> çš„ <em>KV cache</em> çš„æ¯”è¾ƒã€‚<em>MLA</em> ä»…éœ€è¦å°‘é‡çš„ <em>KV cache</em> ï¼Œä¸åªæœ‰2.25ä¸ªç»„çš„ <em>GQA</em> ç›¸å½“ï¼Œä½†å´èƒ½å®ç°æ¯” <em>MHA</em> æ›´å¼ºçš„æ€§èƒ½ã€‚
<img src="./pic/1.jpg" alt=""></p>
<h3 id="deepseekmoe-training-strong-models-at-economical-costs">DeepSeekMoE: Training Strong Models at Economical Costs</h3>
<h4 id="basic-architecture">Basic Architecture</h4>
<p>å¯¹äº <em>FFNs</em>ï¼Œå›¢é˜Ÿé‡‡ç”¨äº† <em>DeepSeekMoE</em> æ¶æ„ã€‚<em>DeepSeekMoE</em> æœ‰ä¸¤ä¸ªå…³é”®ç†å¿µï¼šä¸€æ˜¯å°†ä¸“å®¶åˆ†å‰²æˆæ›´ç»†çš„ç²’åº¦ä»¥æé«˜ä¸“å®¶çš„ä¸“ä¸šåŒ–ç¨‹åº¦å’ŒçŸ¥è¯†è·å–çš„å‡†ç¡®æ€§ï¼›äºŒæ˜¯éš”ç¦»ä¸€äº›å…±äº«ä¸“å®¶ä»¥å‡å°‘è·¯ç”±ä¸“å®¶ä¹‹é—´çš„çŸ¥è¯†å†—ä½™ã€‚åœ¨æ¿€æ´»çš„ä¸“å®¶å‚æ•°æ•°é‡å’Œæ€»çš„ä¸“å®¶å‚æ•°é‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œ<em>DeepSeekMoE</em> ç›¸æ¯”ä¼ ç»Ÿçš„ <em>MoE</em> æ¶æ„æœ‰æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚</p>
<p>ä»¤ $u_t$ è¡¨ç¤ºç¬¬ <em>t</em> ä¸ª <em>token</em> çš„ <em>FFN</em> è¾“å…¥ï¼Œå›¢é˜ŸæŒ‰ç…§å¦‚ä¸‹æ–¹å¼è®¡ç®— <em>FFN</em> è¾“å‡º $h_t^{\prime}$â€‹ï¼š</p>
\[h_t^{\prime} = {u_t} + \sum\limits_{i = 1}^{{N_s}} {FFN_i^{\left( s \right)}} \left( {{u_t}} \right) + \sum\limits_{i = 1}^{{N_r}} {{g_{i,t}}FFN_i^{\left( r \right)}} \left( {{u_t}} \right)\]\[{s_{i,t}} = softmax_{i}\left( {u_t^T{e_i}} \right)\]<p>å…¶ä¸­ï¼Œ
$Ns$â€‹Â å’ŒÂ $Nr$Â åˆ†åˆ«è¡¨ç¤ºå…±äº«ä¸“å®¶å’Œè·¯ç”±ä¸“å®¶çš„æ•°é‡ï¼›
$FFN^{(s)}_i(â‹…)$Â å’ŒÂ $FFN^{(r)}_i(â‹…)$Â åˆ†åˆ«è¡¨ç¤ºç¬¬Â <em>i</em>Â ä¸ªå…±äº«ä¸“å®¶å’Œç¬¬Â <em>i</em>Â ä¸ªè·¯ç”±ä¸“å®¶ï¼›
<em>Kr</em>â€‹Â è¡¨ç¤ºæ¿€æ´»çš„è·¯ç”±ä¸“å®¶æ•°é‡ï¼›
$g_{i,t}$ æ˜¯ç¬¬Â <em>i</em>Â ä¸ªä¸“å®¶å¯¹äºç¬¬Â <em>t</em>Â ä¸ª <em>token</em> çš„é—¨æ§å€¼ï¼›
$s_{i,t}$â€‹Â è¡¨ç¤º <em>token</em> åˆ°ä¸“å®¶çš„äº²å’Œåº¦ï¼›
$e_i$â€‹Â æ˜¯è¯¥å±‚ä¸­ç¬¬Â <em>i</em>Â ä¸ªè·¯ç”±ä¸“å®¶çš„ä¸­å¿ƒç‚¹ï¼›
$Topk(â‹…,K)$Â è¡¨ç¤ºæ ¹æ®ä¸ºç¬¬Â <em>t</em>Â ä¸ª <em>token</em> å’Œæ‰€æœ‰è·¯ç”±ä¸“å®¶è®¡ç®—å‡ºçš„äº²å’Œåº¦åˆ†æ•°ä¸­çš„å‰Â <em>K</em>Â ä¸ªæœ€é«˜åˆ†æ•°ç»„æˆçš„é›†åˆã€‚</p>
<h2 id="alignment">Alignment</h2>
<h3 id="supervised-fine-tuning">Supervised Fine-Tuning</h3>
<p>åŸºäºå›¢é˜Ÿä¹‹å‰çš„ç ”ç©¶ï¼Œå›¢é˜Ÿç²¾å¿ƒç­–åˆ’äº†æŒ‡ä»¤è°ƒä¼˜æ•°æ®é›†ï¼ŒåŒ…å«150ä¸‡æ¡å®ä¾‹ï¼Œå…¶ä¸­120ä¸‡æ¡ç”¨äºæé«˜æœ‰ç”¨æ€§ï¼ˆhelpfulnessï¼‰ï¼Œ30ä¸‡æ¡ç”¨äºå¢å¼ºå®‰å…¨æ€§ï¼ˆsafetyï¼‰ã€‚ç›¸æ¯”æœ€åˆçš„ç‰ˆæœ¬ï¼Œå›¢é˜Ÿæå‡äº†æ•°æ®è´¨é‡ä»¥å‡å°‘å¹»è§‰å“åº”å¹¶æé«˜å†™ä½œèƒ½åŠ›ã€‚åœ¨å¯¹DeepSeek-V2è¿›è¡Œå¾®è°ƒæ—¶ï¼Œå›¢é˜Ÿä½¿ç”¨äº†2ä¸ªepochï¼Œå¹¶å°†å­¦ä¹ ç‡è®¾ç½®ä¸º5Ã—10^-6ã€‚å¯¹äºDeepSeek-V2 Chatï¼ˆSFTï¼‰çš„è¯„ä¼°ï¼Œå›¢é˜Ÿä¸»è¦é‡‡ç”¨äº†åŸºäºç”Ÿæˆçš„åŸºå‡†æµ‹è¯•ï¼Œé™¤äº†å‡ ä¸ªä»£è¡¨æ€§çš„å¤šé€‰é¢˜ä»»åŠ¡ï¼ˆå¦‚MMLUå’ŒARCï¼‰ã€‚æ­¤å¤–ï¼Œå›¢é˜Ÿè¿˜ä½¿ç”¨äº†æŒ‡ä»¤éµå¾ªè¯„ä¼°ï¼ˆIFEvalï¼‰ï¼ˆZhouç­‰ï¼Œ2023ï¼‰æ¥è¯„ä¼°DeepSeek-V2 Chatï¼ˆSFTï¼‰ï¼Œé‡‡ç”¨æç¤ºçº§åˆ«çš„å®½æ¾å‡†ç¡®ç‡ä½œä¸ºè¯„ä¼°æŒ‡æ ‡ã€‚ä¸ºäº†è¿›ä¸€æ­¥è¯„ä¼°èŠå¤©æ¨¡å‹ï¼Œå›¢é˜Ÿä½¿ç”¨äº†ä»2023å¹´9æœˆ1æ—¥è‡³2024å¹´4æœˆ1æ—¥çš„LiveCodeBenchï¼ˆJainç­‰ï¼Œ2024ï¼‰é—®é¢˜ã€‚é™¤äº†æ ‡å‡†åŸºå‡†æµ‹è¯•å¤–ï¼Œå›¢é˜Ÿè¿˜åœ¨å¼€æ”¾å¼çš„å¯¹è¯åŸºå‡†ä¸Šè¿›ä¸€æ­¥è¯„ä¼°äº†å›¢é˜Ÿçš„æ¨¡å‹ï¼ŒåŒ…æ‹¬MT-Benchï¼ˆZhengç­‰ï¼Œ2023ï¼‰ã€AlpacaEval 2.0ï¼ˆDuboisç­‰ï¼Œ2024ï¼‰å’ŒAlignBenchï¼ˆLiuç­‰ï¼Œ2023ï¼‰ã€‚ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œå›¢é˜Ÿä¹Ÿåœ¨ç›¸åŒçš„è¯„ä¼°æ¡†æ¶å’Œè®¾ç½®ä¸‹è¯„ä¼°äº†Qwen1.5 72B Chatã€LLaMA-3-70B Instructä»¥åŠMistral-8x22B Instructã€‚è‡³äºDeepSeek 67B Chatçš„è¯„ä¼°ç»“æœï¼Œå›¢é˜Ÿç›´æ¥å¼•ç”¨äº†ä¹‹å‰å‘å¸ƒçš„è¯„ä¼°æŠ¥å‘Šä¸­çš„æ•°æ®ã€‚</p>
<h3 id="reinforcement-learning">Reinforcement Learning</h3>
<p>ä¸ºäº†è¿›ä¸€æ­¥æŒ–æ˜DeepSeek-V2çš„æ½œåŠ›å¹¶ä½¿å…¶ä¸äººç±»åå¥½å¯¹é½ï¼Œå›¢é˜Ÿé‡‡ç”¨äº†å¼ºåŒ–å­¦ä¹ ï¼ˆReinforcement Learning, RLï¼‰æ¥è°ƒæ•´å…¶åå¥½ã€‚å¼ºåŒ–å­¦ä¹ ç®—æ³•ã€‚ä¸ºäº†èŠ‚çœRLçš„è®­ç»ƒæˆæœ¬ï¼Œå›¢é˜Ÿé‡‡ç”¨äº†<strong>ç»„ç›¸å¯¹ç­–ç•¥ä¼˜åŒ–ï¼ˆGroup Relative Policy Optimization, GRPOï¼‰</strong>ã€‚<em>GRPO</em> æ”¾å¼ƒäº†ä¸€èˆ¬ä¸ç­–ç•¥æ¨¡å‹åŒæ ·å¤§å°çš„è¯„è®ºå®¶æ¨¡å‹ï¼ˆcritic modelï¼‰ï¼Œè€Œæ˜¯é€šè¿‡ç»„è¯„åˆ†æ¥ä¼°è®¡åŸºçº¿ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºæ¯ä¸ªé—®é¢˜$\displaystyle q$ï¼ŒGRPOä»æ—§ç­–ç•¥$\displaystyle \pi_{\theta_{old}}$ä¸­é‡‡æ ·ä¸€ç»„è¾“å‡º$\displaystyle {o_{1},o_{2},\dots,o_{G}}$ï¼Œç„¶åé€šè¿‡æœ€å¤§åŒ–ä»¥ä¸‹ç›®æ ‡å‡½æ•°æ¥ä¼˜åŒ–ç­–ç•¥æ¨¡å‹$\displaystyle \pi_{\theta}$ï¼š</p>
\[
\mathcal{J}_{G R P O}(\theta)=\mathbb{E}\left[q \sim P(Q),\left\{o_i\right\}_{i=1}^G \sim \pi_{\theta_{o l d}}(O \mid q)\right] 
\]\[\frac{1}{G}\sum\limits_{i = 1}^G {\left( {\min \left( {\frac{{{\pi _\theta }\left( {{o_i}\left| q \right.} \right)}}{{{\pi _{{\theta _{old}}}}\left( {{o_i}\left| q \right.} \right)}}{A_i},clip\left( {\frac{{{\pi _\theta }\left( {{o_i}\left| q \right.} \right)}}{{{\pi _{{\theta _{old}}}}\left( {{o_i}\left| q \right.} \right)}},1 - \varepsilon ,1 + \varepsilon } \right){A_i}} \right) - \beta {D_{KL}}\left( {{\pi _\theta }\left\| {{\pi _{ref}}} \right.} \right)} \right)},
\]\[
  {D_{KL}}\left( {{\pi _\theta }\left\| {{\pi _{ref}}} \right.} \right) = \frac{{{\pi _{ref}}\left( {{o_i}\left| q \right.} \right)}}{{{\pi _\theta }\left( {{o_i}\left| q \right.} \right)}} - \log \frac{{{\pi _{ref}}\left( {{o_i}\left| q \right.} \right)}}{{{\pi _\theta }\left( {{o_i}\left| q \right.} \right)}} - 1,
\]<p>
å…¶ä¸­ï¼Œ$\varepsilon$ å’Œ $\beta$ å‡ä¸ºè¶…å‚æ•°ï¼Œ$A_i$æ˜¯ä¼˜åŠ¿å€¼ï¼Œå®ƒæ˜¯ä½¿ç”¨ä¸€ç»„ä¸æ¯ä¸ªç»„å†…çš„è¾“å‡ºç›¸å¯¹åº”çš„å¥–åŠ±$\left\{ {{r_1},{r_2}, \ldots ,{r_G}} \right\}$è®¡ç®—å¾—å‡ºçš„:</p>
\[{A_i} = \frac{{{r_i} - mean\left( {\left\{ {{r_1},{r_2}, \ldots ,{r_G}} \right\}} \right)}}{{std\left( {\left\{ {{r_1},{r_2}, \ldots ,{r_G}} \right\}} \right)}}\]<p><strong>è®­ç»ƒç­–ç•¥</strong>ã€‚åœ¨åˆæ­¥å®éªŒä¸­ï¼Œå›¢é˜Ÿå‘ç°é’ˆå¯¹æ¨ç†æ•°æ®ï¼ˆå¦‚ä»£ç å’Œæ•°å­¦æç¤ºï¼‰è¿›è¡Œçš„å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒå±•ç°å‡ºä¸æ™®é€šæ•°æ®è®­ç»ƒä¸åŒçš„ç‹¬ç‰¹ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œæ¨¡å‹çš„æ•°å­¦å’Œç¼–ç èƒ½åŠ›å¯ä»¥åœ¨è¾ƒé•¿çš„è®­ç»ƒæ­¥éª¤ä¸­æŒç»­æ”¹è¿›ã€‚åŸºäºæ­¤è§‚å¯Ÿï¼Œå›¢é˜Ÿé‡‡ç”¨äº†ä¸¤é˜¶æ®µçš„RLè®­ç»ƒç­–ç•¥ï¼šç¬¬ä¸€é˜¶æ®µï¼šæ¨ç†å¯¹é½ï¼ˆReasoning Alignmentï¼‰ï¼Œå¯¹äºä»£ç å’Œæ•°å­¦æ¨ç†ä»»åŠ¡ï¼Œå›¢é˜Ÿè®­ç»ƒäº†ä¸€ä¸ªå¥–åŠ±æ¨¡å‹$\displaystyle RM_{reasoning}$ï¼Œå¹¶ä¸”ä¼˜åŒ–äº†$\displaystyle RM_{reasoning}$å‰é¦ˆçš„ç­–ç•¥æ¨¡å‹ï¼š
åœ¨ç¬¬äºŒé˜¶æ®µçš„äººç±»åå¥½å¯¹é½ä¸­ï¼Œå›¢é˜Ÿé‡‡ç”¨äº†ä¸€ä¸ªå¤šå¥–åŠ±æ¡†æ¶ï¼Œè¯¥æ¡†æ¶ä»ä¸‰ä¸ªä¸åŒçš„å¥–åŠ±æ¨¡å‹è·å–å¥–åŠ±ï¼š</p>
<ol>
<li>$\displaystyle RM_{helpful}$â€‹ï¼šè¯„ä¼°è¾“å‡ºçš„æœ‰ç”¨æ€§æˆ–ç›¸å…³æ€§ã€‚</li>
<li>$\displaystyle RM_{safety}$â€‹ï¼šè¯„ä¼°è¾“å‡ºçš„å®‰å…¨æ€§ï¼Œç¡®ä¿å†…å®¹é€‚åˆä¸”ä¸åŒ…å«æœ‰å®³ä¿¡æ¯ã€‚</li>
<li>$\displaystyle RM_{rule}$â€‹ï¼šæ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™é›†è¯„ä¼°è¾“å‡ºï¼Œç¡®ä¿éµå®ˆç‰¹å®šçš„æ ‡å‡†æˆ–æ ¼å¼ã€‚
æœ€åå¥–åŠ±ç»“æœ$\displaystyle o_{i}$ä¸ºï¼š
\[{r_i} = {c_1} \cdot R{M_{helpful}}\left( {{o_i}} \right) + {c_2} \cdot R{M_{safety}}\left( {{o_i}} \right) + {c_3} \cdot R{M_{rule}}\left( {{o_i}} \right)\]</li>
</ol>
<p>å…¶ä¸­ï¼Œ$c_1$,$c_2$,$c_3$ä¸ºå¯¹åº”ç³»æ•°</p>
<p>ä¸ºäº†è·å¾—åœ¨å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒä¸­èµ·å…³é”®ä½œç”¨çš„å¯é å¥–åŠ±æ¨¡å‹ï¼Œå›¢é˜Ÿç²¾å¿ƒæ”¶é›†åå¥½æ•°æ®ï¼Œå¹¶ç»†è‡´åœ°è¿›è¡Œè´¨é‡è¿‡æ»¤å’Œæ¯”ä¾‹è°ƒæ•´ã€‚å›¢é˜ŸåŸºäºç¼–è¯‘å™¨åé¦ˆè·å–ä»£ç åå¥½æ•°æ®ï¼ŒåŸºäºçœŸå®æ ‡ç­¾ï¼ˆground-truth labelsï¼‰è·å–æ•°å­¦åå¥½æ•°æ®ã€‚åœ¨å¥–åŠ±æ¨¡å‹è®­ç»ƒä¸­ï¼Œå›¢é˜Ÿä½¿ç”¨DeepSeek-V2 Chatï¼ˆSFTï¼‰åˆå§‹åŒ–å¥–åŠ±æ¨¡å‹ï¼Œå¹¶é€šè¿‡ç‚¹å¯¹ç‚¹ï¼ˆpoint-wiseï¼‰æˆ–æˆå¯¹ï¼ˆpair-wiseï¼‰æŸå¤±å‡½æ•°å¯¹å…¶è¿›è¡Œè®­ç»ƒã€‚åœ¨å®éªŒä¸­ï¼Œå›¢é˜Ÿè§‚å¯Ÿåˆ°RLè®­ç»ƒèƒ½å¤Ÿå……åˆ†æŒ–æ˜å¹¶æ¿€æ´»æ¨¡å‹çš„æ½œåŠ›ï¼Œä½¿å…¶èƒ½å¤Ÿä»å¯èƒ½çš„å›ç­”ä¸­é€‰æ‹©å‡ºæ—¢æ­£ç¡®åˆä»¤äººæ»¡æ„çš„ç­”æ¡ˆã€‚</p>
<!-- ![](./pic/2.jpg) -->

        
      </section>

      

      
    </article>
  </div>

  <div
    x-data="tocHighlighter()"
    @scroll.window="debouncedScroll"
    class="hidden lg:flex lg:flex-col lg:items-end">
    
      <nav id="TableOfContents">
  <ol>
    <li><a href="#architecture">Architecture</a></li>
    <li><a href="#alignment">Alignment</a></li>
  </ol>
</nav>
    
  </div>
</div>


            
<footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12">

  <div>
  
  <p>
    Â© 2025 dO.ob&#39;s Blog
  </p>
  

  
  <p class="text-sm">
    ğŸŒ±
    <span class="text-base-content/60">
      Powered by <a class="hover:underline" href="https://gohugo.io/" target="_blank">Hugo</a> with theme
      <a class="hover:underline" href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</span
    >
  </p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="max-w-[65ch] mt-8 mx-auto px-4">
  
  
  
  <div>
    <div class="mb-4 text-lg font-medium">å…³äºæˆ‘</div>

    <div class="prose dark:prose-invert">
      <p>æˆ‘æ˜¯ä¸€åAIä»ä¸šè€…ï¼Œè‡´åŠ›äºäººå·¥æ™ºèƒ½å’Œæ•°æ®é©±åŠ¨è¡Œä¸šã€‚</p>
<p>è¸ä¸Šå–ç»è·¯ï¼Œæ¯”æŠµè¾¾çµå±±æ›´é‡è¦</p>

    </div>
  </div>
  <div class="divider divider-vertical"></div>
  
  

  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 max-w-[65ch] mx-auto px-4 md:px-0 py-12">

  <div>
  
  <p>
    Â© 2025 dO.ob&#39;s Blog
  </p>
  

  
  <p class="text-sm">
    ğŸŒ±
    <span class="text-base-content/60">
      Powered by <a class="hover:underline" href="https://gohugo.io/" target="_blank">Hugo</a> with theme
      <a class="hover:underline" href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</span
    >
  </p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme = "forest"
</script>





<script src="/js/main.js"></script>

    







<script src="/js/toc.js"></script>





    

    

    

    

    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js" integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin="anonymous"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js" integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin="anonymous"></script>
  </body>
</html>
